<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/jpeg" href="top1.jpg">
    <title>R√°dio Top Itatiba FM - 91.5</title>

    <meta property="og:title" content="R√°dio Top Itatiba FM - 91.5">
    <meta property="og:description" content="A Top de Itatiba! Ou√ßa ao vivo.">
    <meta property="og:image" content="https://radiotopitatiba.com.br/top1.jpg">
    
    <meta name="theme-color" content="#b01a7a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="top1.jpg">

    <style>
        :root {
            --magenta: #b01a7a;
            --roxo-neon: #aa00ff;
            --dourado: #f3b644;
            --fundo-neon: #050816;
            --verde-whatsapp: #00ff55;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background-color: var(--fundo-neon); color: #eee; scroll-behavior: smooth; overflow-x: hidden; }

        /* --- NOVO ESTILO DA CAPA (PC E CELULAR) --- */
        .area-player-visual {
            position: relative;
            width: 100%;
            height: 400px; /* Altura fixa para ficar bonito no PC */
            overflow: hidden;
            border-bottom: 2px solid var(--magenta);
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        /* Fundo desfocado (Efeito Spotify) */
        .bg-blur {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(30px) brightness(0.4);
            z-index: 1;
            transition: background-image 1s ease;
        }

        /* A capa n√≠tida no centro */
        .capa-destaque {
            position: relative;
            z-index: 5;
            width: 280px;
            height: 280px;
            border-radius: 15px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            object-fit: cover;
            border: 2px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, src 0.5s ease;
        }
        
        .capa-destaque:hover { transform: scale(1.05); }

        @media (max-width: 600px) {
            .area-player-visual { height: 320px; }
            .capa-destaque { width: 220px; height: 220px; }
        }
        /* ----------------------------------------- */

        .firework { position: fixed; width: 4px; height: 4px; border-radius: 50%; z-index: 9999; pointer-events: none; }
        @keyframes explode { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(30); opacity: 0; } }

        .noticias-ticker {
            background: #000; color: var(--dourado); padding: 10px 0;
            border-bottom: 1px solid #333; overflow: hidden; white-space: nowrap;
            font-weight: bold; font-size: 14px; text-transform: uppercase; display: flex; z-index: 900;
        }
        .ticker-content { display: inline-block; padding-left: 100%; animation: ticker-move 90s linear infinite; }
        @keyframes ticker-move { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        .noticia-item { margin-right: 50px; }

        nav { 
            background: rgba(10, 14, 39, 0.95); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(176, 26, 122, 0.5); padding: 12px 0; 
            display: flex; justify-content: center; gap: 10px; position: sticky; top: 0; z-index: 1000; 
        }
        nav a { 
            color: #ddd; text-decoration: none; font-weight: 800; text-transform: uppercase; font-size: 11px; 
            padding: 8px 14px; border-radius: 20px; transition: 0.3s;
        }
        nav a:hover { background: var(--magenta); color: white; }

        .player-bar { 
            background: linear-gradient(0deg, #050816 0%, #1a1a2e 100%); 
            padding: 20px; border-top: 1px solid #333;
            display: flex; flex-direction: column; align-items: center; gap: 15px; 
        }

        .glass-controls {
            background: rgba(255,255,255,0.1); border-radius: 50px; padding: 10px 25px; 
            display: flex; align-items: center; gap: 20px; border: 1px solid rgba(255,255,255,0.1);
        }
        
        .btn-player-modern {
            width: 65px; height: 65px; background: var(--magenta); border-radius: 50%; border: none; 
            color: white; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px var(--magenta); transition: 0.3s;
        }
        .playing-pulse { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(176, 26, 122, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(176, 26, 122, 0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }

        .info-musica-container { text-align: center; margin-bottom: 10px; }
        #nome-musica { font-size: 18px; font-weight: bold; color: white; display: block; margin-bottom: 5px; }
        #artista-musica { font-size: 14px; color: var(--dourado); }

        .btn-studio { background: #000; color: #fff; border: 1px solid #ff0000; padding: 8px 20px; border-radius: 50px; text-decoration: none; font-weight: bold; font-size: 12px; display: inline-flex; align-items: center; gap: 8px; }
        .dot { width: 8px; height: 8px; background: #ff0000; border-radius: 50%; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .section-title { border-left: 4px solid var(--magenta); padding-left: 10px; margin: 30px 0 15px; font-size: 22px; color: white; text-transform: uppercase; }

        /* Estilos gerais de inputs e bot√µes */
        .mural-input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #333; background: #111; color: white; box-sizing: border-box;}
        .btn-enviar { width: 100%; padding: 12px; background: var(--magenta); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        .whatsapp-float { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: var(--verde-whatsapp); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 5000; box-shadow: 0 5px 20px rgba(0,0,0,0.5); color: #000; }
        
        /* Modal e Slides */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; align-items: center; justify-content: center; }
        .modal-content { background: #1a1a2e; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; border: 1px solid var(--magenta); position: relative; }
        .close-modal { position: absolute; top: 10px; right: 15px; color: white; font-size: 24px; cursor: pointer; }
        .img-slide { width: 100%; height: 200px; object-fit: cover; border-radius: 10px; margin-bottom: 15px; }

        #splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--fundo-neon); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20000; transition: transform 0.8s ease-in-out; }
        
        footer { text-align: center; padding: 40px; background: #000; margin-top: 40px; border-top: 1px solid #333; }
        
        .painel-clima { display: flex; justify-content: space-between; background: rgba(255,255,255,0.05); padding: 10px 20px; border-radius: 10px; margin-top: 20px; font-size: 14px; font-weight: bold;}
    </style>
</head>
<body>

    <div id="splash-screen">
        <img src="top1.jpg" style="width: 150px; border-radius: 50%; border: 4px solid var(--magenta); box-shadow: 0 0 30px var(--magenta); margin-bottom: 20px;">
        <h2 style="color:white; margin-bottom:30px;">R√ÅDIO TOP ITATIBA</h2>
        <button onclick="iniciarSite()" style="padding: 15px 40px; background: var(--magenta); color: white; border: none; border-radius: 30px; font-weight: bold; font-size: 16px; cursor: pointer; box-shadow: 0 0 20px var(--magenta);">ENTRAR</button>
    </div>

    <div id="modal-container" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal" onclick="document.getElementById('modal-container').style.display='none'">√ó</span>
            <h3 id="modal-title" style="color:var(--dourado); margin-top:0;">INFO</h3>
            <div id="modal-body"></div>
        </div>
    </div>

    <div class="area-player-visual">
        <div id="bg-blur" class="bg-blur" style="background-image: url('top1.jpg');"></div>
        <img id="capa-album" src="top1.jpg" class="capa-destaque" alt="Capa do √Ålbum">
    </div>

    <div class="noticias-ticker">
        <div style="background:var(--magenta); color:white; padding:0 15px; z-index:10;">PLANT√ÉO</div>
        <div class="ticker-content">
            <span class="noticia-item">Carregando informa√ß√µes...</span>
        </div>
    </div>

    <nav>
        <a href="#">HOME</a>
        <a href="#pedir">PEDIR M√öSICA</a>
        <a href="#mural">MURAL</a>
        <a href="javascript:void(0)" onclick="location.reload()">ATUALIZAR</a>
    </nav>

    <div class="player-bar">
        <div class="info-musica-container">
            <span id="nome-musica">Carregando...</span>
            <span id="artista-musica">R√°dio Top Itatiba</span>
        </div>

        <audio id="radio-top" preload="none"><source src="https://server27.srvsh.com.br:6674/stream" type="audio/mpeg"></audio>

        <div class="glass-controls">
            <button id="btn-player" class="btn-player-modern" onclick="togglePlay()">
                <svg id="icon-play" width="30" height="30" viewBox="0 0 24 24" fill="white"><path d="M8 5v14l11-7z"/></svg>
                <svg id="icon-pause" width="30" height="30" viewBox="0 0 24 24" fill="white" style="display:none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>
            <input type="range" min="0" max="1" step="0.1" value="0.5" onchange="document.getElementById('radio-top').volume=this.value" style="width: 80px;">
        </div>

        <div style="display:flex; gap:10px; margin-top:10px;">
            <a href="https://www.youtube.com/watch?v=HoP0JQ9MV6g" target="_blank" id="link-studio" class="btn-studio"><span class="dot"></span> STUDIO AO VIVO</a>
            <span style="font-size:12px; color:#888; align-self:center;">üéß <span id="ouvintes">...</span> OUVINTES</span>
        </div>
    </div>

    <div class="container">
        
        <div class="painel-clima">
            <span id="clock">00:00</span>
            <span id="temp-itatiba">üå§Ô∏è Carregando...</span>
        </div>

        <h2 id="pedir" class="section-title">üéµ PE√áA SUA M√öSICA</h2>
        <div style="background:#111; padding:20px; border-radius:10px; border:1px solid #333;">
            <input type="text" id="pedido-nome" class="mural-input" placeholder="Seu Nome">
            <input type="text" id="pedido-musica" class="mural-input" placeholder="Nome da M√∫sica">
            <button onclick="enviarZap()" class="btn-enviar" style="background:var(--verde-whatsapp); color:black;">PEDIR NO WHATSAPP</button>
        </div>

        <h2 class="section-title">üìÖ PROGRAMA√á√ÉO</h2>
        <div id="prog-lista" style="display:flex; flex-direction:column; gap:10px;"></div>

        <h2 id="mural" class="section-title">üí¨ MURAL DE RECADOS</h2>
        <div class="mural-container">
            <form id="form-mural">
                <input type="text" id="mural-nome" class="mural-input" placeholder="Seu Nome" required>
                <textarea id="mural-msg" class="mural-input" rows="3" placeholder="Sua mensagem..." required></textarea>
                <button type="submit" class="btn-enviar">ENVIAR RECADO</button>
            </form>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-top:30px;">
            <button onclick="abrirModal('getTopHits','TOP HITS')" style="background:#1a1a2e; border:1px solid var(--magenta); color:white; padding:20px; border-radius:10px; cursor:pointer;">üèÜ TOP HITS</button>
            <button onclick="abrirModal('getEquipe','EQUIPE')" style="background:#1a1a2e; border:1px solid var(--magenta); color:white; padding:20px; border-radius:10px; cursor:pointer;">üéôÔ∏è EQUIPE</button>
        </div>

    </div>

    <a href="https://wa.me/5511945914382" class="whatsapp-float" target="_blank">
        <svg style="width:30px;height:30px" viewBox="0 0 24 24"><path fill="currentColor" d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01A9.816 9.816 0 0 0 12.04 2m.01 1.67c2.2 0 4.26.86 5.82 2.42a8.225 8.225 0 0 1 2.41 5.83c0 4.54-3.7 8.23-8.24 8.23-1.48 0-2.93-.39-4.19-1.14l-.3-.17-3.12.82.83-3.04-.19-.3a8.209 8.209 0 0 1-1.26-4.38c0-4.54 3.7-8.24 8.24-8.24m-3.53 2.32c-.13 0-.34.05-.52.25-.19.21-.72.7-.72 1.71s.73 1.99.83 2.12c.11.13 1.44 2.19 3.48 3.07.48.21.86.34 1.15.43.49.15.94.13 1.29.08.39-.06 1.21-.5 1.38-.98.17-.48.17-.89.12-.98-.05-.09-.18-.14-.38-.24s-1.21-.6-1.4-.67c-.18-.07-.32-.1-.46.12-.14.21-.53.67-.65.81-.12.14-.24.16-.44.06s-.83-.31-1.58-.98c-.58-.52-.97-1.16-1.09-1.36-.11-.2-.01-.31.09-.41.09-.09.2-.24.3-.35.1-.11.14-.19.21-.32.07-.13.03-.25-.02-.35-.05-.1-.46-1.1-.63-1.51-.16-.4-.33-.35-.46-.35z"/></svg>
    </a>

    <footer>
        <p style="color:#666;">¬© 2026 R√°dio Top Itatiba - 91.5 FM</p>
    </footer>

    <script>
        const urlGoogle = "https://script.google.com/macros/s/AKfycbxDl8bLK77gE83X-X6Va8GK6lVGsJBVCukxL6DsLUy6RRpO78iqM7Z5sdu_U9tbA6oLUg/exec";
        let audio = document.getElementById('radio-top');
        let isPlaying = false;
        let currentCover = 'top1.jpg'; // Vari√°vel para guardar a capa atual

        function iniciarSite() {
            document.getElementById('splash-screen').style.transform = 'translateY(-100%)';
            audio.play().then(() => { 
                isPlaying = true;
                updatePlayerUI();
            }).catch(e => console.log("Play bloqueado"));
            
            atualizarTudo();
        }

        function togglePlay() {
            if(isPlaying) { audio.pause(); isPlaying = false; }
            else { audio.load(); audio.play(); isPlaying = true; }
            updatePlayerUI();
        }

        function updatePlayerUI() {
            document.getElementById('icon-play').style.display = isPlaying ? 'none' : 'block';
            document.getElementById('icon-pause').style.display = isPlaying ? 'block' : 'none';
            if(isPlaying) document.getElementById('btn-player').classList.add('playing-pulse');
            else document.getElementById('btn-player').classList.remove('playing-pulse');
        }

        // --- SISTEMA INTELIGENTE DE CAPA E METADADOS ---
        function carregarConfig() {
            // Adiciona timestamp para n√£o pegar cache
            fetch(urlGoogle + "?action=getConfig&t=" + new Date().getTime()).then(r => r.json()).then(data => {
                
                // 1. Atualiza Letreiro e Bot√£o
                if (data.noticias) {
                    const html = data.noticias.split('.').map(t => `<span class="noticia-item">‚ú® ${t.trim()}</span>`).join('');
                    document.querySelector('.ticker-content').innerHTML = html + html;
                }
                if (data.botao) document.getElementById('link-studio').href = data.botao;

                // 2. L√≥gica da Capa + Nome da M√∫sica
                // O script do Google j√° fez o trabalho dif√≠cil. Vamos ler da C√©lula F2 e A2 (via JSON do config)
                // Nota: Vou ajustar sua fun√ß√£o getConfig no HTML para ler A2/F2 indiretamente pelo texto do letreiro ou podemos fazer melhor:
                // Como o getConfig retorna TV (A2), usamos ele.
                
                let capaUrl = data.tv || 'top1.jpg';
                
                // DETECTAR COMERCIAL: Se a capa for a padr√£o, assume que √© comercial ou fala
                let nomeMusicaDisplay = "R√°dio Top Itatiba";
                
                // Tenta extrair o nome da m√∫sica do letreiro (gambiarra inteligente) ou usa o proxy
                atualizarMetadadosProxy(capaUrl);

            }).catch(() => {});
        }

        function atualizarMetadadosProxy(capaSheet) {
            // Usa o AllOrigins para pegar o nome real da m√∫sica do streaming
            fetch("https://api.allorigins.win/get?url=" + encodeURIComponent("http://server27.srvsh.com.br:6674/currentsong?sid=1&t=" + new Date().getTime()))
            .then(r => r.json()).then(data => {
                let musicaRaw = data.contents;
                
                // L√ìGICA DE COMERCIAL
                if(!musicaRaw || musicaRaw.trim() == "" || musicaRaw.includes("Vinheta") || musicaRaw.includes("Comercial")) {
                    currentCover = 'top1.jpg'; // For√ßa Logo
                    document.getElementById('nome-musica').innerText = "R√°dio Top Itatiba";
                    document.getElementById('artista-musica').innerText = "A Melhor da Regi√£o";
                } else {
                    currentCover = capaSheet; // Usa capa do Google Sheet (iTunes)
                    document.getElementById('nome-musica').innerText = musicaRaw;
                    document.getElementById('artista-musica').innerText = "No Ar Agora";
                }

                // ATUALIZA O VISUAL (BLUR E CAPA)
                document.getElementById('capa-album').src = currentCover;
                document.getElementById('bg-blur').style.backgroundImage = `url('${currentCover}')`;

                // ATUALIZA SEGUNDO PLANO (TELA DE BLOQUEIO)
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: document.getElementById('nome-musica').innerText,
                        artist: "R√°dio Top 91.5 FM",
                        artwork: [
                            { src: currentCover, sizes: '96x96', type: 'image/jpg' },
                            { src: currentCover, sizes: '512x512', type: 'image/jpg' }
                        ]
                    });
                    
                    navigator.mediaSession.setActionHandler('play', togglePlay);
                    navigator.mediaSession.setActionHandler('pause', togglePlay);
                }

            }).catch(() => {});
        }

        function carregarProgramacao() {
            fetch(urlGoogle + "?action=getProgramacao").then(r => r.json()).then(data => {
                let html = "";
                data.forEach(p => {
                    html += `<div style="background:#1a1a2e; padding:10px; border-radius:8px; border-left:4px solid var(--magenta); display:flex; align-items:center;">
                        <div style="background:var(--magenta); padding:5px 10px; border-radius:5px; font-weight:bold; margin-right:10px;">${p.hora}</div>
                        <div><div style="font-weight:bold;">${p.titulo}</div><div style="font-size:12px; color:#aaa;">${p.descricao}</div></div>
                    </div>`;
                });
                document.getElementById('prog-lista').innerHTML = html;
            });
        }

        // --- UTILIT√ÅRIOS ---
        function enviarZap() {
            let n = document.getElementById('pedido-nome').value;
            let m = document.getElementById('pedido-musica').value;
            if(n && m) window.open(`https://wa.me/5511945914382?text=Ol√°! Sou ${n} e quero pedir: ${m}`, '_blank');
        }

        document.getElementById('form-mural').addEventListener('submit', function(e){
            e.preventDefault();
            let btn = this.querySelector('button'); btn.innerText = "ENVIANDO...";
            fetch(urlGoogle, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ nome: document.getElementById('mural-nome').value, mensagem: document.getElementById('mural-msg').value }) })
            .then(() => { alert("Recado Enviado!"); btn.innerText = "ENVIAR RECADO"; this.reset(); });
        });

        function abrirModal(action, title) {
            document.getElementById('modal-container').style.display = 'flex';
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-body').innerHTML = "Carregando...";
            fetch(urlGoogle + "?action=" + action).then(r => r.json()).then(data => {
                let html = "";
                data.forEach(d => {
                    let img = d.imagem || d.foto || 'top1.jpg';
                    let txt = d.musica || d.nome || '';
                    html += `<div style="margin-bottom:20px;"><img src="${img}" class="img-slide"><div style="font-weight:bold;">${txt}</div></div>`;
                });
                document.getElementById('modal-body').innerHTML = html;
            });
        }

        function atualizarTudo() {
            carregarConfig();
            carregarProgramacao();
            
            // Rel√≥gio
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('pt-BR').substring(0,5);
            
            // Clima
            fetch("https://api.open-meteo.com/v1/forecast?latitude=-23.00&longitude=-46.84&current_weather=true")
            .then(r => r.json()).then(d => {
                document.getElementById('temp-itatiba').innerText = "üå§Ô∏è " + Math.round(d.current_weather.temperature) + "¬∞C";
            });
        }

        // Atualiza√ß√£o R√°pida (10 segundos) para tentar sincronizar capa e m√∫sica
        setInterval(carregarConfig, 10000); 
    </script>
</body>
</html>
